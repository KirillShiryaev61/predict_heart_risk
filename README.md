# Прогнозирование риска сердечного приступа  

**Машинное обучение + Веб-приложение**

> **Внимание**: Проект выполнен в образовательных целях. Прогноз не заменяет консультацию врача и не предназначен для клинического использования.

---

## О проекте:

Этот проект направлен на **прогнозирование риска сердечного приступа** с использованием методов машинного обучения и визуализации результата через веб-интерфейс.

На основе медицинских данных (возраст, давление, уровень холестерина, образ жизни и др.) модель оценивает вероятность сердечного приступа. Решение может помочь врачам и пациентам вовремя выявлять риски и принимать профилактические меры.

Проект состоит из двух частей:
- **ML-модель** — обученная на медицинских данных для предсказания риска.
- **Веб-приложение** — интерфейс для ввода данных и получения прогноза.

---

## Цель:

Построить модель бинарной классификации для определения **риска сердечного приступа (0 — низкий, 1 — высокий)** с акцентом на чувствительность к положительным случаям (выявление пациентов в группе риска).

---

## Данные:

Используются два датасета:
- `heart_train.csv` — обучающая выборка
- `heart_test.csv` — тестовая выборка

### Описание признаков:

* **Unnamed: 0** — индекс строки;
* **Age** — возраст ***(отмасштабирован)***;
* **Cholesterol** — уровень холестерина ***(отмасштабирован)***;
* **Heart rate** — частота сердечных сокращений ***(отмасштабирован)***;
* **Diabetes** — наличие сахарного диабета ***(0 - нет; 1 - да)***;
* **Family History** — наличие сердечно-сосудистых заболеваний у близких родственников ***(0 - нет; 1 - да)***;
* **Smoking** — курение ***(0 - нет; 1 - да)***;
* **Obesity** — наличие ожирения ***(0 - нет; 1 - да)***;
* **Alcohol Consumption** — употребление алкоголя ***(0 - нет; 1 - да)***;
* **Exercise Hours Per Week** — количество часов физической нагрузки в неделю ***(отмасштабирован)***;
* **Diet** — тип диеты ***(от 0 до 3)***;
* **Previous Heart Problems** — наличие сердечных заболеваний в анамнезе ***(0 - нет; 1 - да)***;
* **Medication Use** — принимает ли лекарства ***(0 - нет; 1 - да)***;
* **Stress Level** — уровень стресса ***(от 1 до 10)***;
* **Sedentary Hours Per Day** — количество часов в день проведенных сидя ***(отмасштабирован)***;
* **Income** — доход ***(отмасштабирован)***;
* **BMI** — индекс массы тела ***(отмасштабирован)***;
* **Triglycerides** — концентрация триглицеридов в крови ***(отмасштабирован)***;
* **Physical Activity Days Per Week** — количество дней с физической нагрузкой в неделю ***(от 0 до 7)***;
* **Sleep Hours Per Day** — количество часов сна в день ***(отмасштабирован)***;
* **Heart Attack Risk** — риск сердечного приступа **(целевой признак)** ***(0 - нет; 1 - да)***;
* **Blood sugar** — уровень сахара в крови ***(отмасштабирован)***;
* **CK-MB** — фермент, повышающийся в крови при повреждении сердечной мышцы ***(отмасштабирован)***;
* **Troponin** — уровень кардиоспецифического белка тропонина I или T в крови ***(отмасштабирован)***;
* **Gender** — пол ***(Male, Female)***;
* **Systolic blood pressure** — давление в артериях в момент, когда сердце сокращается ***(отмасштабирован)***;
* **Diastolic blood pressure** — давление в артериях в момент расслабления сердца ***(отмасштабирован)***;
* **id** — уникальный индификатор.

> ***\*(отмасштабирован)*** — означает, что признак приведен к диапозону значений от 0 до 1.

---

## Исследование и обучение модели:

### Используемый алгоритм:

- **CatBoostClassifier** — градиентный бустинг с поддержкой категориальных признаков.

### Гиперпараметры:

```python
{
  'iterations': 100,
  'learning_rate': 0.1,
  'auto_class_weights': 'Balanced',
  'l2_leaf_reg': 3,
  'max_depth': 10
}
```

### Отбор признаков:

- Использован `SelectKBest` с оптимальным количеством признаков: **18**.
- `PolynomialFeatures` не улучшили модель и были отброшены.

### Метрики:

- **F2_score_macro**: **0.43**
- При пороге **0.365** модель выявляет **90% пациентов с высоким риском**.

### Анализ важности признаков (SHAP):

Наиболее значимые признаки:
1. BMI (индекс массы тела)
2. Уровень триглицеридов
3. Артериальное давление
4. Часы физической активности в неделю
5. Количество сна в день
6. Частота сердечных сокращений

> **Замечание**: Модель показала противоречивое поведение — признак `Obesity` иногда интерпретируется как *уменьшающий* риск. Это может указывать на шум в данных или недостаточную информативность признаков. Требуется дообучение с более качественными данными.

---

## Реализация приложения:

### Архитектура:

- **Бэкенд**: FastAPI (Python)
- **Фронтенд**: React (Vite)
- **Модель**: `catboost.cbm` (сохранена в формате CatBoost)
- **Порог срабатывания**: 0.365 (оптимизирован для баланса precision/recall)

### Как работает приложение:

1. Пользователь заполняет анкету в браузере.
2. Данные отправляются на бэкенд (`POST /predict`).
3. Модель делает предсказание вероятности сердечного приступа.
4. Результат отображается: **"Высокий риск"** или **"Низкий риск"**.

> Прогноз:
> - **Высокий риск**, если `P(1) >= 0.365`
> - **Низкий риск**, если `P(0) < 0.365`

---

## Выводы и дальнейшие улучшения:

### Выводы:

- Модель **CatBoost** показала приемлемую чувствительность (90% выявления риска), но низкий F2-score, что говорит о несбалансированности данных и необходимости улучшения.
- Текущая версия модели **не готова к клиническому применению**, но может служить основой для дальнейшего развития.

### Планы по улучшению:

1. **Получить неотмасштабированные данные** — для корректного анализа аномалий и Feature Engineering.


2. **Улучшить признаки**:
>   - Заменить бинарные признаки (например, `Smoking`, `Alcohol`) на количественные (объём, частота).
>   - Добавить информацию о типе диеты, висцеральном жире, ЭКГ и др.
>   - Ввести составные признаки (например, пульсовое давление = систолическое - диастолическое).

3. **Использовать более сложные модели** (например, ансамбли или нейросети).
4. **Добавить интерпретацию SHAP в интерфейс** — для объяснения прогноза пациенту.

---

## Заключение:

Человеческий организм — сложная система, и для точного прогноза здоровья необходимо учитывать **качество данных, контекст и физиологию**. Этот проект — шаг к созданию инструмента поддержки принятия решений в медицине, но его развитие требует тесного взаимодействия с врачами и доступа к более детальным данным.

---

## Структура репозитория:

```
PROJECT_HEART_RISK/                  # Основная папка проекта
│
├── heart-risk-app/                  # Основная папка приложения
│   │
│   ├── backend/                     # FastAPI-сервер
│   │   │
│   │   ├── catboost.cbm             # Обученная модель
│   │   ├── main.py                  # Основной файл приложения
│   │   └── requirements.txt         # Зависимости Python
│   │
│   ├── frontend/                    # React/Vite приложение
│   │   │
│   │   ├── public/                  # Публичные ресурсы
│   │   ├── src/                     # Исходный код React
│   │   ├── index.html               # Главная страница
│   │   ├── vite.config.js           # Конфигурация Vite
│   │   ├── package.json             # Зависимости и скрипты
│   │   ├── README.md                # Шаблон настроек фронтенда
│   │   └── package-lock.json        # Зафиксированные версии пакетов
│   │
│   └── README.md                    # Описание приложения и инструкция
│                                    # по запуску
│   
├── predict_heart_risk.ipynb         # Ноутбук с обучением модели
├── test_predict.csv                 # Предсказания на тестовой выборке
├── app_video.mov                    # Видео-презентация приложения
└── README.md                        # Основной README

```